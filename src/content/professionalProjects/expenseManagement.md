I worked closely with the head of finance and the CTO of Greengage to design and develop a system for handling expense claims inside of Salesforce. The reasoning for doing this in Salesforce is primarily because of the Approval Process which we could use to ensure the right people approve the expense before it gets paid out.

So, I created an Expense Claim object and created fields that we needed, like the amount to be paid, the date of the expense etc, with added file support so users could upload receipts if the user had one to upload. Once they were happy, they would submit it for approval, whereby it was assigned to their expense approver (tracked by a lookup to user on the User object) in the approval process, and then it would progress up the stack until it was either approved or rejected. 

The complexity here comes from two pieces of automation that I implemented here:
- The first being that Expense Claims needed to support both EUR and GBP expenses, and could be paid in either as well, which meant we had to use exchange rates to convert GBP to EUR or vice versa. I did this by utilising a package that SLS had created and was installed in our environment called `SLSExRates` which worked by creating daily records per conversion (stored in metadata) in Salesforce which contained the exchange rate for that day, and so the trigger of Expense Claims would query out the exchange rate for the date of the expense, and convert it to the target currency, storing the result and the exchange rate record used on the relevant expense claim record, all whilst being done in bulk so we could update 200+ records at once. This was done in a way whereby adding a new currency to the picklist fields controlling this automation would work flawlessly (assuming the exchange rate existed). Should an exchange rate be missing for the expense's date, then the logic would also look for an earlier exchange rate to use instead.
- The second being that these expense claims also supported mileage claims, where employees could request compensation for money spent on travel. The amount the employee would get would be based on the Gov allowances for travel (Which can be found [here](https://www.gov.uk/government/publications/rates-and-allowances-travel-mileage-and-fuel-allowances/travel-mileage-and-fuel-rates-and-allowances)). So we had a custom setting that contained the compensation amount and the ranges that compensation applied to, and the expense claim trigger would use previous mileage expense claims to work out which band the new expense claim would fit into, and then work out how much money they were owed.

There were also additional automations that I created here:
- One being that due to the Expense Claim being a private object, we had to share the record with whoever was going to eventually approve it, so there was an automation that looked at the owner of the record and created a share record against the relevant expense claim record if the Expense Approver didn't have access already. This also removed this share (assuming the share reason was from this automation) should the owner be changed and have a different expense approver.
- Once being deployed, we found that if someone was part of the groups of the later approval process steps, then they could self approve, which was an issue, so there was a minor validation added which ran when the approval process attempted to update the expense claim with the update status where it then verifies that the approver and the owner were not the same user